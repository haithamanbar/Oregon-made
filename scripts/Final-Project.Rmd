---
title: "The Relationship of Student Attendance and Student Proficiency in English, Language, and Arts "
author: "Tram Anh Hoang, Haitham Anbar, Maria Coronado, Erick Njue"
date: "`r Sys.Date()`"
output: pdf_document
bibliography: references.bib 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, results='hide')


library(here)
library(rio)
library(readr)
library(janitor)
library(tidyverse)
library(knitr)

```


# Abstract

# Introduction
We use data from the Oregon Department of Education (ODE) to examine the following research questions:  

* Does attendance rate affect student proficiency in English, Language, and Arts? and;
* Does such a relationship between attendance and proficiency vary for different racial and ethnic groups?  
 
We use data of student attendance rate  and student proficiency rate  from the ODE assessment group reports for all the schools in the state. We will base our assessment on the latest academic year available for both data sets, which is 2021 – 2022.

# Methods
In this research, we run a regression model on attendance data and proficiency data of schools in Oregon. We obtain two different data sets from the ODE: attendance rate by school and student group, and proficiency in English, Language, and Arts by student group. 

## Data description and preparation

We use [@R] package [@here] to read in the two data sets from Oregon Department of Education (ODE)into the [@R] environment. We use [@janitor] to clean the names. After preparing the data sets, we display them as tables using [@tidyverse].

```{r read_data}

race <- import(here("data", "pagr_schools_ela_tot_raceethnicity_2122.csv")) %>% 
  clean_names() %>%
  as_tibble()

attend <- import(here("data", "regularattenders_report_2122.csv")) %>% 
  clean_names() %>%
  as_tibble()
```

The first data set is student performance in English Language and Arts (ELA) from all schools in the state. The data set provides the number and percentage of students that are proficient in each of the four levels of ELA proficiency, stratified by school, race and ethnicity, and grade level. This data set has `r nrow(race)` rows and `r ncol(race)` columns.  

The second data set is student attendance data from all the schools in Oregon. This data set provides the number and percentage of regular attenders as well as those of chronically absent students, stratified by school and either race and ethnicity or grade level. This data set has `r nrow(attend)` rows and `r ncol(attend)` columns.  

We clean the two data sets by removing rows with no data and rows with suppressed data, marked as “- -” and “*” respectively. We use {dplyr} package functions in [@tidyverse] to do so. 

```{r clean_attendance}
#Summarizing to check the existing student groups in the file
attendsum <- attend %>% 
 group_by(student_group) %>% 
  summarise()

#Filtering the dataframe leaving only student groups related to race. 
attend1 <- attend %>% 
   filter(student_group %in% c("White",
                               "Hispanic/Latino",
                               "Black/African American", 
                               "Asian",
                               "American Indian/Alaska Native",
                               "Native Hawaiian/Pacific Islander",
                               "Multi-Racial")) %>%
  mutate(student_group=recode(student_group,"Native Hawaiian/Pacific Islander" = "Pacific Islander"))


#Removing rows without data
#Mutate attendance data to be numeric
attend1 <- attend1%>% 
  filter(students_included != "*") %>%
  mutate(students_included=as.numeric(students_included),
         number_regular_attenders=as.numeric(number_regular_attenders),
         percent_regular_attenders=as.numeric(percent_regular_attenders),
         number_chronically_absent=as.numeric(number_chronically_absent),
         percent_chronically_absent=as.numeric(percent_chronically_absent))
    
# Note: All schools with >95% and <5% regular attenders were eliminated. 
#These rows corresponded with schools where less than 9 students were included. 

```

```{r clean_profifiency}
#Finding the races considered in the file
racesum <- race %>% 
 group_by(student_group) %>% 
  summarise()

#Filtering the dataframe leaving only student groups related to race.
#Filtered again to remove rows without data on proficiency data
#Transformed number of participants to numeric and the filtered to all >= than 10 students. 
race1 <- race %>% 
   select(-grade_level) %>% 
     filter(student_group == "American Indian/Alaskan Native" |
          student_group == "Asian"|
          student_group == "Black/African American" |
          student_group == "Hispanic/Latino" |
          student_group == "Multi-Racial" |
          student_group == "Pacific Islander" |
          student_group == "White") %>% 
 filter(number_proficient != "*" &
        number_proficient != "--" &
        number_of_participants != "-") %>%
 transform(number_of_participants = as.numeric(number_of_participants))

#Transformed all columns to numbers to be able to compute them. The file had them as characters.
race2<- race1 %>% 
  transform(
    number_proficient = as.numeric(number_proficient), 
    percent_proficient_level_3_or_4 = as.numeric(percent_proficient_level_3_or_4),
    number_level_4 = as.numeric(number_level_4), 
    percent_level_4 = as.numeric(percent_level_4), 
    number_level_3 = as.numeric(number_level_3), 
    percent_level_3 = as.numeric(percent_level_3), 
    number_level_2 = as.numeric(number_level_2), 
    percent_level_2 = as.numeric(percent_level_2), 
    number_level_1 = as.numeric(number_level_1),
    percent_level_1 = as.numeric(percent_level_1), 
    participation_rate = as.numeric(participation_rate)
    )

#Grouped data by school_id and student_group, summed the number of participants and number of proficient students, and re-calculate the percentage of proficient students.
race3 <- race2 %>% 
 group_by(district_id,school_id, student_group) %>% 
 summarise(number_proficient = sum(number_proficient),
           number_of_participants=sum(number_of_participants)) %>%
  mutate(percent_proficient = number_proficient/number_of_participants*100)


```

After cleaning, we merge the two data sets by matching schools’ IDs and student race and ethnicity. Rows with attendance data only or proficiency data only will be removed. We use the _left_join_ in the {dplyr} and _drop_na_ in{tidyr}, all contained in [@tidyverse]

```{r join}
#Check that 2 data sets have matching student groups
unique(attend1$student_group)
unique(race3$student_group)

#Join
attend_race <- left_join(attend1, race3, by=c("district_id"="district_id", "institution_id"="school_id", "student_group"="student_group")) %>%
  drop_na()

```
## Methods

Research question, hypothesis
Details about sample: sample size =n, race and ethnic group

Our paper looks at two research questions:  
1. Does attendance rate affect student proficiency in English, Language, and Arts?; and  
2. Does such a relationship between attendance and proficiency vary for different racial and ethnic groups?  

Our data sets obtained from the Oregon Department of Education is school-level data, broken down by racial and ethnic groups. While the relationship between attendance and student proficiency would be better explained from student-level data, we were not able to obtain data in such format.  

### RQ1: Does attendance rate affect student proficiency in English, Language, and Arts?  

Our hypothesis is that schools with higher student attendance have higher rate of student proficiency in English, Language, and Arts.  

To answer the first research question, we run a linear regression model, using schools' proficiency rate as the dependent variable, and attendance rate as the independent variable. Our regression equation is: percent_proficient = a + b*percent_regular_attenders + e

### RQ2: Does such a relationship between attendance and proficiency vary for different racial and ethnic groups?  
Once our hypothesis for the first research question is confirmed, we would like to look at whether students' racial and ethnic backgrounds had implications on the effect of attendance on student proficiency. In other words, if students have different racial and ethnic backgrounds, would attendance improve proficiency in the same way. Our hypothesis is that schools will see different impacts of attendance on proficiency for different student groups.  


# Results

We use the function _pivot_wider_ by student group in [@tidyverse] package {tidyr} to have columns by race. This is followed by _pivot_longer_ and another _pivot_wider_ to make the table presentable. We use the _kable_ function found in [@Xie2021-ps] to present the results. 

To interpret our results, we further present them in a scatter plots using {ggplot2} of [@tidyverse]. In Plot 1, we plot the percentage of proficient students based on the rate of regular attendance. In Plot 2 below, we use _facet_wrap_ function of {ggplot2} plot the rate of regular attendance by percentage of proficient students based on the race.  

```{r plot1, results='asis'}

#Adding plot for attendance vs. proficiency
attend_race %>%
  group_by(institution_id) %>%
  summarize(students_included = sum(students_included),
            number_regular_attenders = sum(number_regular_attenders),
            percent_regular_attenders = number_regular_attenders/students_included *100,
            number_proficient = sum(number_proficient),
            number_of_participants = sum(number_of_participants),
            percent_proficient = number_proficient/number_of_participants *100) %>%
  ggplot(aes(x=percent_regular_attenders, y=percent_proficient)) +
  geom_point() +
  geom_smooth(method='lm', color="violet") +
  theme_bw() +
  labs(title="Student Attendance and Proficiency Rate \n in English, Language, and Arts",
       subtitle="Data from Oregon Education Department",
       x="Rate of Regular Attendance (%)",
       y="Percentage of proficient students (%)",
       tag = "Plot 1")

```

Doing regression

```{r regression}
attpro <- lm(formula = percent_regular_attenders~percent_proficient  , data = attend_race)
summary(attpro) 
```

The estimated y-intercept is 46.57 which tells us the predicted value of proficiency when school attendance is zero.

Summary table

```{r summary-table, results='markup'}

#Transforming relevant columns into integrer
attend_race <- attend_race %>%
  transform(
    students_included = as.integer(students_included), 
    number_regular_attenders = as.integer(number_regular_attenders), 
    number_chronically_absent = as.integer(number_chronically_absent)) 


#Summary attendance grouped by race (not by institutions)
attend_summary <- attend_race %>%
    group_by(student_group) %>% 
    summarise(students_included = sum(students_included),
            number_regular_attenders = sum(number_regular_attenders),
            number_chronically_absent = sum(number_chronically_absent)) %>% 
  mutate(percent_regular_attenders = (number_regular_attenders / students_included * 100)) %>% 
  mutate(percent_regular_attenders = round(percent_regular_attenders, 2)) %>% 
  mutate(percent_chron_absent = (number_chronically_absent / students_included * 100)) %>% 
  mutate(percent_chron_absent = round(percent_chron_absent, 2)) 

attend_summary <- attend_summary  %>%
  select(-number_chronically_absent, -number_regular_attenders, -students_included, -percent_chron_absent) %>% 
  pivot_wider(
    names_from = "student_group",
    values_from = "percent_regular_attenders") %>% 
  clean_names() %>% 
pivot_longer(
  cols = 1:6,
  names_to = "Race",
  values_to = "Regular attenders") 
  


#Summary proficiency by race (not by institutions)
prof_summary <- attend_race %>%
  group_by(student_group) %>% 
  summarise(number_of_participants = sum(number_of_participants),
            number_proficient = sum(number_proficient)) %>% 
  mutate(percent_prof_race = (number_proficient/number_of_participants*100)) %>% 
  mutate(percent_prof_race = round(percent_prof_race, 2)) %>% 
  select(-number_of_participants, -number_proficient) %>% 
 pivot_wider(names_from = "student_group",
 values_from = "percent_prof_race") %>% 
  clean_names() %>% 
  pivot_longer(
      cols = 1:6,
  names_to = "Race",
  values_to = "Percent proficient") 


mixed_table <- left_join(attend_summary, prof_summary)

mixed_table <- mixed_table %>% 
  mutate(Race = recode(Race, 
                       asian = "Asian",
                       hispanic_latino = "Hispanic/latino",
                       black_african_american = "Black African American",
                       multi_racial = "Multi Racial",
                       pacific_islander = "Pacific Islander",
                       white = "White"
                       ))

mixed_table %>% 
  kable(caption="Summary table",
        col.names=c("Race/ ethnicity",
                    "Percent Chronically absent", 
                    "Percent proficient"))

    
```

```{r plot2}

#Adding plot for attendance vs. proficiency, faceted by race
attend_race %>%
  ggplot(aes(x=percent_regular_attenders, y=percent_proficient,group=student_group)) +
  geom_point() +
  geom_smooth(method='lm', color="violet") +  
  facet_wrap(~student_group) +
  theme_bw() +
  labs(title="Student Attendance and Proficiency Rate \n in English, Language, and Arts by Different Races",
       subtitle="Data from Oregon Education Department",
       x="Rate of Regular Attendance (%)",
       y="Percentage of proficient students (%)",
       tag="Plot 2")

```







# Discussions

## Regression and Plot 1
When looking at school-level data, attendance rate and proficiency rate has a positive relationship. Schools with 1% higher attendance rate saw a x% increase in their percentage of proficient students. Our linear model explains ...% of the data point, with the standard error of...

## Regression and Plot 2
When faceted by students' racial and ethnic groups, we can see a clear change in the slope of the line. Using White students as the reference group, the Asian group has a steeper slope, suggesting 1% increase in attendance rate results in a higher increase in the rate of proficiency for the Asian group than for the White group. Whereas, the Black/African American group, the Hispanic/Latino group, and the Pacific Islander group had flatter line, suggesting that the positive impact of attendance rate on proficiency rate is weaker for these groups than for their White counterparts.  

Interestingly, all the data points for the Asian group show up after in the far right part of their plot, indicating high attendance rate for this group of students - above 60% in all the schools we looked at. Contradictingly, the Pacific Islander group had low attendance - below 70% across all schools.


\newpage
# References


